<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' file: data:;" />
    <title>タスク編集 - NyanTaskNotes</title>
    <style>
      body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
      header { display: flex; align-items: center; justify-content: space-between; padding: 10px 16px; border-bottom: 1px solid #ddd; }
      main { display: grid; grid-template-columns: 320px 1fr; height: calc(100vh - 52px); }
      #left { border-right: 1px solid #eee; display: flex; flex-direction: column; }
      #search { padding: 8px; border: none; border-bottom: 1px solid #eee; }
      #taskList { overflow: auto; }
      .item { padding: 10px 12px; border-bottom: 1px solid #f0f0f0; cursor: pointer; }
      .item.active { background: #eef6ff; }
      .meta { color: #666; font-size: 12px; margin-top: 2px; }
      #right { padding: 16px; overflow: auto; }
      .row { display: flex; gap: 8px; align-items: center; margin: 8px 0; }
      label { width: 110px; color: #333; }
      input[type=text], input[type=date], input[type=time], select, textarea { flex: 1; padding: 6px 8px; }
      textarea { min-height: 80px; }
      .actions { display: flex; gap: 8px; margin-top: 16px; }
      button { padding: 8px 12px; }
      h3 { margin-top: 20px; }
      .small { color: #666; font-size: 12px; }
    </style>
  </head>
  <body>
    <header>
      <div>タスク編集</div>
      <div class="actions">
        <button id="newBtn">新規</button>
        <button id="saveBtn">保存</button>
        <button id="deleteBtn">削除</button>
      </div>
    </header>
    <main>
      <section id="left">
        <input id="search" type="text" placeholder="検索 (タイトル/説明)" />
        <div id="taskList"></div>
      </section>
      <section id="right">
        <form id="taskForm" onsubmit="return false;">
          <input type="hidden" id="taskId" />
          <div class="row"><label for="title">タイトル</label><input id="title" type="text" required /></div>
          <div class="row"><label for="description">説明</label><textarea id="description"></textarea></div>
          <div class="row">
            <label for="tags">タグ</label>
            <div style="flex:1; display:flex; gap:8px; align-items:center; position:relative; flex-wrap: wrap;">
              <div id="tagChips" class="tags" style="flex:1; min-height: 28px;"></div>
              <input id="addTagInput" type="text" placeholder="タグを追加" style="width: 160px;" />
              <button id="addTagBtn" type="button">追加</button>
              <input id="tags" type="text" style="display:none;" />
            </div>
          </div>
          
          <div class="row"><label for="dueAt">期日</label><input id="dueAt" type="date" /></div>

          <h3>繰り返し</h3>
          <div class="row"><label for="isRecurring">繰り返し</label>
            <select id="isRecurring">
              <option value="once">１回のみ</option>
              <option value="daily">毎日</option>
              <option value="monthly">毎月（日付）</option>
              <option value="monthlyNth">第n週m曜日</option>
            </select>
          </div>
          <div class="row"><label for="startDate">開始日</label><input id="startDate" type="date" /></div>
          <div class="row"><label for="startTime">開始時刻</label><input id="startTime" type="time" /></div>
          <div class="row"><label for="monthlyDay">毎月の開始日</label><input id="monthlyDay" type="number" min="1" max="31" placeholder="1..31" /></div>
          <div class="row"><label for="monthlyNth">第n週</label>
            <select id="monthlyNth">
              <option value="1">第1</option>
              <option value="2">第2</option>
              <option value="3">第3</option>
              <option value="4">第4</option>
              <option value="5">第5</option>
              <option value="-1">最終</option>
            </select>
            <select id="monthlyNthDow" style="flex:1;">
              <option value="0">日曜日</option>
              <option value="1">月曜日</option>
              <option value="2">火曜日</option>
              <option value="3">水曜日</option>
              <option value="4">木曜日</option>
              <option value="5">金曜日</option>
              <option value="6">土曜日</option>
            </select>
          </div>
          <div class="row"><label for="recurrenceCount">繰り返し回数</label><input id="recurrenceCount" type="number" min="0" placeholder="0=無限, 1.." /></div>
          <div class="row"><label for="dailyHorizonDays">生成日数（毎日）</label><input id="dailyHorizonDays" type="number" min="1" max="365" placeholder="例: 14" /></div>
          <div class="small">「繰り返し」で「毎月（日付）」は毎月の同じ日付。「第n週m曜日」は毎月の特定の週と曜日（例: 第2週火曜/最終週金曜）。「毎日」は開始日から毎日生成します。</div>
        </form>
      </section>
    </main>
    <script type="module" src="js/taskEditor.js"></script>
  </body>
  </html>
